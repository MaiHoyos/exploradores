<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Misi√≥n 0: Ensamblaje del Robot - Zython</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * { font-family: 'Fredoka', sans-serif; }

    :root{
      --card: rgba(255,255,255,.10);
      --border: rgba(255,255,255,.18);
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 24px;
      --accent: #60a5fa;  /* blue-400 */
      --accent2:#a78bfa;  /* purple-400 */
    }

    /* Accesibilidad: enfoque visible */
    :focus-visible{
      outline: 3px solid rgba(96,165,250,.8);
      outline-offset: 3px;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    body {
      background: linear-gradient(-45deg, #1a0b2e, #16213e, #0f3460, #533483);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      padding-top: 92px; /* espacio para header fijo */
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.6), 0 0 60px rgba(147, 51, 234, 0.4); }
      50% { box-shadow: 0 0 50px rgba(59, 130, 246, 0.9), 0 0 90px rgba(147, 51, 234, 0.6); }
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: translateY(30px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    /* Glow del t√≠tulo de la portada */
    @keyframes titleGlow {
      0%, 100% {
        text-shadow: 0 0 20px rgba(59, 130, 246, 0.8),
                     0 0 40px rgba(147, 51, 234, 0.6),
                     0 0 60px rgba(236, 72, 153, 0.4);
      }
      50% {
        text-shadow: 0 0 30px rgba(59, 130, 246, 1),
                     0 0 60px rgba(147, 51, 234, 0.8),
                     0 0 90px rgba(236, 72, 153, 0.6);
      }
    }

    .title-hero { animation: titleGlow 3s ease-in-out infinite; }

    @keyframes floatRocket {
      0%, 100% { transform: translateY(0px) rotate(-5deg); }
      50% { transform: translateY(-30px) rotate(5deg); }
    }

    .float-rocket { animation: floatRocket 3s ease-in-out infinite; }

    .animate-float { animation: float 4s ease-in-out infinite; }
    .animate-pulse-glow { animation: pulse-glow 3s ease-in-out infinite; }
    .animate-fade-in-scale { animation: fadeInScale 0.8s ease-out; }
    .animate-fade-in { animation: fadeIn 1.2s ease-out; }
    .animate-bounce { animation: bounce 2s ease-in-out infinite; }

    /* Fondo de estrellas */
    .stars {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
      transition: transform .2s ease; /* para parallax suave */
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
      box-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    @keyframes shootingStar {
      0% { transform: translateX(0) translateY(0); opacity: 1; }
      100% { transform: translateX(-300px) translateY(300px); opacity: 0; }
    }

    .shooting-star {
      position: fixed;
      width: 2px; height: 2px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
      animation: shootingStar 1s linear;
      z-index: 1;
    }

    /* Contenedor video */
    .video-container {
      position: relative;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
    }

    .video-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
      border-radius: var(--radius);
      pointer-events: none;
    }

    iframe { width: 100%; height: 500px; display: block; }

    /* Tarjeta glass unificada */
    .glass-card {
      background: var(--card);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
    }

    /* Bot√≥n 3D */
    .btn-3d {
      transition: all 0.3s ease;
      box-shadow: 0 6px 0 rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    .btn-3d:hover { transform: translateY(-2px); box-shadow: 0 8px 0 rgba(0, 0, 0, 0.3), 0 15px 30px rgba(0, 0, 0, 0.3); }
    .btn-3d:active { transform: translateY(2px); box-shadow: 0 2px 0 rgba(0, 0, 0, 0.3), 0 5px 10px rgba(0, 0, 0, 0.2); }

    /* Bot√≥n premium: brillo al hover */
    .btn-premium { position: relative; overflow: hidden; }
    .btn-premium::after{
      content:"";
      position:absolute;
      inset:-120%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
      transform: rotate(25deg) translateX(-40%);
      transition: transform .6s ease;
      pointer-events: none;
    }
    .btn-premium:hover::after{ transform: rotate(25deg) translateX(40%); }

    /* Hover im√°genes */
    .image-hover { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .image-hover:hover { transform: scale(1.05) translateY(-5px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); }

    .text-glow { text-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }

    /* Bot√≥n audio flotante */
    .audio-toggle {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      z-index: 1000;
      background: rgba(59, 130, 246, 0.9);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 0.75rem 1.25rem;
      border-radius: 9999px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }
    .audio-toggle:hover { transform: scale(1.05); box-shadow: 0 12px 35px rgba(59, 130, 246, 0.6); }
    .audio-toggle.active { background: rgba(16, 185, 129, 0.9); }

    /* Toast */
    .toast-wrap { top: 110px; } /* debajo del header */

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; }
    }

    @media (max-width: 768px) { iframe { height: 300px; } }
  </style>
</head>

<body class="min-h-screen text-white overflow-x-hidden">
  <div class="stars" id="stars"></div>

  <!-- Header fijo tipo app -->
  <header class="fixed top-0 left-0 right-0 z-50 px-4 py-3">
    <div class="max-w-6xl mx-auto glass-card rounded-2xl px-5 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center text-2xl">ü™ê</div>
        <div>
          <div class="font-bold leading-none">Zython</div>
          <div class="text-xs text-white/70">Misi√≥n 0 ¬∑ Ensamblaje del robot</div>
        </div>
      </div>

      <div class="hidden md:flex items-center gap-3 w-[360px]">
        <div class="text-xs text-white/70">Progreso</div>
        <div class="flex-1 h-2 rounded-full bg-white/10 overflow-hidden">
          <div id="progress-bar" class="h-full bg-gradient-to-r from-cyan-400 to-purple-500 w-[0%]"></div>
        </div>
        <div id="progress-text" class="text-xs text-white/70 w-12 text-right">0%</div>
      </div>

      <button
        onclick="window.location.href='index.html'"
        class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 transition font-bold btn-premium"
        title="Volver al inicio"
      >
        ‚¨ÖÔ∏è Inicio
      </button>
    </div>
  </header>

  <!-- Toast de logros -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 z-50 hidden toast-wrap">
    <div class="glass-card px-6 py-4 rounded-2xl flex items-center gap-3 animate-fade-in">
      <div class="text-2xl" id="toast-icon">üèÖ</div>
      <div>
        <div class="font-bold" id="toast-title">Logro desbloqueado</div>
        <div class="text-sm text-white/80" id="toast-msg">Mensaje</div>
      </div>
    </div>
  </div>

  <!-- Audio -->
  <button id="audio-toggle" class="audio-toggle active" onclick="toggleAudio()">
    üîä Audio ON
  </button>

  <div class="relative z-10 min-h-screen flex flex-col">

    <!-- Paso 0: Portada -->
    <div id="step-0" class="step-container min-h-screen flex flex-col items-center justify-center p-6">
      <div class="max-w-6xl text-center animate-fade-in-scale">
        <div class="text-9xl mb-12 float-rocket">üöÄ</div>
        <h1 class="text-7xl md:text-9xl font-bold mb-8 bg-gradient-to-r from-cyan-300 via-blue-400 to-purple-500 bg-clip-text text-transparent title-hero leading-tight">
          EXPLORACI√ìN<br/>DE ZYTHON
        </h1>
        <p class="text-2xl md:text-3xl text-white/90 mb-12 animate-float">
          Prep√°rate para una aventura incre√≠ble en el espacio
        </p>
        <button onclick="startMission()" class="px-16 py-8 bg-gradient-to-r from-green-500 via-blue-500 to-purple-600 hover:from-green-600 hover:via-blue-600 hover:to-purple-700 rounded-3xl font-bold text-4xl transition-all duration-300 transform hover:scale-110 animate-pulse-glow btn-3d btn-premium">
          ¬°VAMOS! üåü
        </button>
        <div class="mt-6 text-sm text-white/70">
          Tip: tu progreso del ensamblaje se guarda autom√°ticamente ‚úÖ
        </div>
      </div>
    </div>

    <!-- Paso 1: Video -->
    <div id="step-1" class="step-container min-h-screen flex flex-col items-center justify-center p-6 hidden">
      <div class="max-w-5xl text-center animate-fade-in-scale">
        <div class="text-7xl mb-6 animate-float">üåå</div>
        <h1 class="text-5xl md:text-7xl font-bold mb-8 bg-gradient-to-r from-cyan-400 via-blue-400 to-purple-400 bg-clip-text text-transparent text-glow">
          Bienvenido a Zython
        </h1>

        <div class="video-container mb-8">
          <div class="video-overlay"></div>
          <iframe
            id="youtube-video"
            src="https://www.youtube.com/embed/5sJSlfYuTos?autoplay=1&mute=1&enablejsapi=1&rel=0&modestbranding=1&iv_load_policy=3&showinfo=0&fs=1"
            title="Intro Video Zython"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen"
            allowfullscreen
            class="rounded-lg">
          </iframe>
        </div>

        <div id="loading-message" class="text-xl text-white/80 mb-3 animate-bounce">
          üõ∞Ô∏è Estableciendo conexi√≥n con la Estaci√≥n Espacial...
        </div>

        <!-- Loader premium -->
        <div class="max-w-md mx-auto mt-2 mb-6">
          <div class="h-2 rounded-full bg-white/10 overflow-hidden">
            <div id="fake-loader" class="h-full bg-gradient-to-r from-cyan-400 to-purple-500 w-0"></div>
          </div>
          <div id="fake-loader-text" class="text-sm text-white/70 mt-2">Preparando transmisi√≥n‚Ä¶</div>
        </div>

        <div id="video-controls" class="flex justify-center gap-4 mb-8 hidden">
          <button onclick="restartVideo()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-bold transition-all duration-300 transform hover:scale-105 btn-3d btn-premium">
            üîÑ Reiniciar
          </button>
          <button onclick="skipVideo()" class="px-6 py-3 bg-red-600 hover:bg-red-700 rounded-xl font-bold transition-all duration-300 transform hover:scale-105 btn-3d btn-premium">
            ‚è≠Ô∏è Saltar Video
          </button>
        </div>

        <button id="continue-btn" onclick="nextStep()" class="px-10 py-5 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 rounded-2xl font-bold text-2xl transition-all duration-300 transform hover:scale-105 animate-pulse-glow hidden btn-3d btn-premium">
          üöÄ Comenzar Misi√≥n
        </button>
      </div>
    </div>

    <!-- Paso 2: Briefing -->
    <div id="step-2" class="step-container min-h-screen flex-col items-center justify-center p-6 hidden">
      <div class="max-w-4xl text-center animate-fade-in-scale">
        <div class="text-7xl mb-6 animate-float">üéØ</div>
        <h2 class="text-4xl md:text-6xl font-bold mb-6 text-yellow-300 text-glow">
          MISI√ìN 0: Ensamblaje del Robot
        </h2>

        <div class="glass-card rounded-3xl p-8 mb-8">
          <div class="text-lg md:text-xl text-white/90 mb-6 leading-relaxed">
            <p class="mb-4"><span class="text-red-400 font-bold text-2xl">‚ö†Ô∏è CR√çTICO:</span> Sin tu robot compa√±ero, las misiones en Zython son imposibles.</p>
            <p class="mb-4">Tu RoverBot debe ser ensamblado siguiendo las instrucciones oficiales de construcci√≥n.</p>
            <p>Una vez ensamblado, podr√°s explorar los cuatro territorios principales de Zython.</p>
          </div>

          <div class="grid md:grid-cols-2 gap-6 text-left">
            <div class="glass-card rounded-2xl p-6 hover:scale-105 transition-transform duration-300">
              <div class="text-2xl font-bold mb-3 text-cyan-300">üìã Especificaciones</div>
              <ul class="text-white/80 space-y-2 text-lg">
                <li>‚Ä¢ Estructura estable para exploraci√≥n</li>
                <li>‚Ä¢ Motores correctamente conectados</li>
                <li>‚Ä¢ Hub listo para programaci√≥n</li>
              </ul>
            </div>
            <div class="glass-card rounded-2xl p-6 hover:scale-105 transition-transform duration-300">
              <div class="text-2xl font-bold mb-3 text-purple-300">üéØ Objetivo</div>
              <ul class="text-white/80 space-y-2 text-lg">
                <li>‚Ä¢ Seguir im√°genes paso a paso</li>
                <li>‚Ä¢ Verificar cada conexi√≥n</li>
                <li>‚Ä¢ Finalizar el modelo Milo correctamente</li>
                <li>‚Ä¢ Dejar el robot listo para pruebas</li>
              </ul>
            </div>
          </div>
        </div>

        <button onclick="nextStep()" class="px-10 py-5 bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 rounded-2xl font-bold text-2xl transition-all duration-300 transform hover:scale-105 btn-3d btn-premium">
          üîß Iniciar Ensamblaje
        </button>
      </div>
    </div>

    <!-- Paso 3: Ensamblaje -->
    <div id="step-3" class="step-container min-h-screen flex-col items-center justify-center p-6 hidden">
      <div class="max-w-6xl w-full animate-fade-in-scale">
        <div class="text-center mb-8">
          <div class="text-6xl mb-4 animate-float">ü§ñ</div>
          <h2 class="text-4xl md:text-5xl font-bold mb-4 text-cyan-300 text-glow">
            Construye tu robot siguiendo las im√°genes
          </h2>

          <div class="text-2xl text-white/90 mb-2">
            Paso <span id="current-step" class="text-yellow-300 font-bold">1</span> de <span class="text-yellow-300 font-bold">10</span>
          </div>

          <!-- Dots de progreso de ensamblaje -->
          <div class="flex justify-center gap-2 mt-3 mb-2" id="assembly-dots" aria-label="Progreso de ensamblaje"></div>

          <p class="mt-2 text-lg text-white/70">
            Usa los botones para avanzar. Cada pantalla muestra 2 o 3 pasos oficiales de construcci√≥n.
          </p>
        </div>

        <div class="glass-card rounded-3xl p-8">

          <!-- Grupos Milo -->
          <div id="assembly-step-1" class="assembly-step">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 1 a 3</div>
            <div class="grid md:grid-cols-3 gap-6 items-start">
              <img src="Milo/1.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 1">
              <img src="Milo/2.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 2">
              <img src="Milo/3.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 3">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

          <div id="assembly-step-2" class="assembly-step hidden">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 4 a 6</div>
            <div class="grid md:grid-cols-3 gap-6">
              <img src="Milo/4.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 4">
              <img src="Milo/5.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 5">
              <img src="Milo/6.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 6">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

          <div id="assembly-step-3" class="assembly-step hidden">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 7 a 9</div>
            <div class="grid md:grid-cols-3 gap-6">
              <img src="Milo/7.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 7">
              <img src="Milo/8.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 8">
              <img src="Milo/9.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 9">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

          <div id="assembly-step-4" class="assembly-step hidden">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 10 a 12</div>
            <div class="grid md:grid-cols-3 gap-6">
              <img src="Milo/10.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 10">
              <img src="Milo/11.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 11">
              <img src="Milo/12.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 12">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

          <div id="assembly-step-5" class="assembly-step hidden">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 13 a 15</div>
            <div class="grid md:grid-cols-3 gap-6">
              <img src="Milo/13.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 13">
              <img src="Milo/14.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 14">
              <img src="Milo/15.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 15">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

          <div id="assembly-step-6" class="assembly-step hidden">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 16 a 18</div>
            <div class="grid md:grid-cols-3 gap-6">
              <img src="Milo/16.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 16">
              <img src="Milo/17.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 17">
              <img src="Milo/18.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 18">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

          <div id="assembly-step-7" class="assembly-step hidden">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 19 a 21</div>
            <div class="grid md:grid-cols-3 gap-6">
              <img src="Milo/19.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 19">
              <img src="Milo/20.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 20">
              <img src="Milo/21.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 21">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

          <div id="assembly-step-8" class="assembly-step hidden">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 22 a 24</div>
            <div class="grid md:grid-cols-3 gap-6">
              <img src="Milo/22.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 22">
              <img src="Milo/23.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 23">
              <img src="Milo/24.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 24">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

          <div id="assembly-step-9" class="assembly-step hidden">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 25 a 27</div>
            <div class="grid md:grid-cols-3 gap-6">
              <img src="Milo/25.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 25">
              <img src="Milo/26.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 26">
              <img src="Milo/27.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 27">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

          <div id="assembly-step-10" class="assembly-step hidden">
            <div class="mb-6 text-2xl font-bold text-yellow-300 text-center">Pasos 28 y 29 - Modelo completo</div>
            <div class="grid md:grid-cols-2 gap-6">
              <img src="Milo/28.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 28">
              <img src="Milo/29.jpg" class="w-full rounded-2xl shadow-lg mx-auto image-hover" alt="Milo Paso 29">
            </div>
            <p class="mt-6 text-xs md:text-sm text-white/60 text-center leading-relaxed">
              Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro. Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300)
            </p>
          </div>

        </div>

        <div class="flex justify-between mt-8 gap-4">
          <button id="prev-btn" onclick="previousAssemblyStep()" class="px-8 py-4 bg-gray-600 hover:bg-gray-700 rounded-2xl font-bold text-xl transition-all duration-300 opacity-50 btn-3d btn-premium w-40" disabled>
            ‚Üê Anterior
          </button>

          <!-- Atajo -->
          <button onclick="jumpToAssemblyStep(10)" class="px-6 py-4 bg-white/10 hover:bg-white/20 rounded-2xl font-bold text-lg transition-all duration-300 btn-premium">
            Ir al final ‚§¥
          </button>

          <button id="next-btn" onclick="nextAssemblyStep()" class="px-8 py-4 bg-blue-600 hover:bg-blue-700 rounded-2xl font-bold text-xl transition-all duration-300 btn-3d btn-premium w-40">
            Siguiente ‚Üí
          </button>
        </div>

        <div class="text-center mt-4 text-sm text-white/70">
          Progreso guardado: <span id="saved-indicator" class="text-white/90 font-bold">listo</span>
        </div>
      </div>
    </div>

    <!-- Paso 4: Robot ensamblado -->
    <div id="step-4" class="step-container min-h-screen flex-col items-center justify-center p-6 hidden">
      <div class="max-w-4xl text-center animate-fade-in-scale">
        <div class="text-8xl mb-8 animate-float">üîÑ</div>
        <h2 class="text-4xl md:text-6xl font-bold mb-6 text-green-400 text-glow">
          ¬°Robot Ensamblado!
        </h2>
        <div class="glass-card rounded-3xl p-8 mb-8">
          <div class="text-xl md:text-2xl text-white/90 mb-8 leading-relaxed">
            <p class="mb-4">üéâ <span class="text-green-400 font-bold">¬°Excelente trabajo, explorador!</span></p>
            <p class="mb-4">Tu modelo ha sido ensamblado siguiendo las instrucciones oficiales.</p>
            <p class="mb-6">Antes de continuar con las misiones, activaremos el set en Scratch.</p>
          </div>

          <div class="glass-card rounded-2xl p-6 mb-6">
            <div class="text-2xl font-bold mb-4 text-green-300">üîß Verificaci√≥n r√°pida</div>
            <div class="grid md:grid-cols-2 gap-4 text-left">
              <div class="space-y-2 text-lg">
                <div class="flex items-center gap-2"><span class="text-green-400">‚úÖ</span><span>Estructura estable</span></div>
                <div class="flex items-center gap-2"><span class="text-green-400">‚úÖ</span><span>Motores conectados</span></div>
                <div class="flex items-center gap-2"><span class="text-green-400">‚úÖ</span><span>Sensor instalado</span></div>
              </div>
              <div class="space-y-2 text-lg">
                <div class="flex items-center gap-2"><span class="text-green-400">‚úÖ</span><span>Hub encaja correctamente</span></div>
                <div class="flex items-center gap-2"><span class="text-green-400">‚úÖ</span><span>Cables asegurados</span></div>
                <div class="flex items-center gap-2"><span class="text-green-400">‚úÖ</span><span>Listo para conectar en Scratch</span></div>
              </div>
            </div>
          </div>

          <button onclick="activateRobot(event)" class="px-10 py-5 bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 rounded-2xl font-bold text-2xl transition-all duration-300 transform hover:scale-105 animate-pulse-glow btn-3d btn-premium">
            üöÄ Activar Robot en Scratch
          </button>
        </div>
      </div>
    </div>

    <!-- Paso 5: Ir a Scratch -->
    <div id="step-5" class="step-container min-h-screen flex-col items-center justify-center p-6 hidden">
      <div class="max-w-4xl text-center animate-fade-in-scale">
        <div class="text-7xl mb-6 animate-float">üß©</div>
        <h2 class="text-4xl md:text-5xl font-bold mb-4 text-cyan-300 text-glow">
          Conecta tu LEGO Education WeDo 2.0 en Scratch
        </h2>
        <p class="text-xl text-white/90 mb-6">
          Ahora vamos a vincular tu robot con Scratch para que puedas controlarlo en las pr√≥ximas misiones.
        </p>

        <div class="glass-card rounded-3xl p-8 text-left space-y-4">
          <ol class="list-decimal list-inside space-y-3 text-white/90 text-lg">
            <li>Abre Scratch en tu navegador o la app utilizada en el aula.</li>
            <li>Inicia sesi√≥n con tu usuario (o el de tu aula).</li>
            <li>Haz clic en el bot√≥n de <span class="font-bold text-cyan-300">Extensiones</span> (abajo a la izquierda).</li>
            <li>Selecciona la extensi√≥n <span class="font-bold text-green-300">LEGO Education WeDo 2.0</span>.</li>
            <li>Enciende tu Hub WeDo 2.0 y presiona su bot√≥n.</li>
            <li>En la ventana que aparece, haz clic en <span class="font-bold text-purple-300">"Inicia la b√∫squeda"</span> y espera a que tu dispositivo se conecte.</li>
          </ol>
          <p class="text-base text-white/70 mt-4">
            Si la conexi√≥n falla, verifica que el Bluetooth est√© activado y vuelve a intentarlo.
          </p>
        </div>

        <button onclick="nextStep()" class="mt-8 px-12 py-5 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 hover:from-purple-600 hover:via-pink-600 hover:to-red-600 rounded-2xl font-bold text-2xl transition-all duration-300 transform hover:scale-105 btn-3d btn-premium">
          ‚úÖ Ya conectamos el set
        </button>
      </div>
    </div>

    <!-- Paso 6: Misi√≥n completada -->
    <div id="step-6" class="step-container min-h-screen flex-col items-center justify-center p-6 hidden">
      <div class="max-w-4xl text-center animate-fade-in-scale">
        <div class="text-8xl mb-8 animate-bounce">üåü</div>
        <h2 class="text-4xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-yellow-400 via-orange-400 to-red-400 bg-clip-text text-transparent text-glow">
          ¬°Misi√≥n 0 Completada!
        </h2>

        <div class="glass-card rounded-3xl p-8 mb-8">
          <div class="text-xl md:text-2xl text-white/90 mb-8 leading-relaxed">
            <p class="mb-4">üéØ <span class="text-yellow-400 font-bold">¬°Incre√≠ble trabajo!</span></p>
            <p class="mb-4">Has ensamblado tu robot y lo has conectado correctamente en Scratch.</p>
            <p class="mb-6">Ahora tienes acceso a las <span class="text-cyan-400 font-bold">4 zonas principales</span> del planeta Zython.</p>
          </div>

          <div class="grid md:grid-cols-2 gap-4 mb-8">
            <div class="glass-card rounded-2xl p-6 hover:scale-105 transition-transform duration-300">
              <div class="text-5xl mb-2">üèîÔ∏è</div>
              <div class="font-bold text-orange-300 text-xl">Llanura de Vectonia</div>
              <div class="text-base text-white/80">Calibra tu RoverBot</div>
            </div>
            <div class="glass-card rounded-2xl p-6 hover:scale-105 transition-transform duration-300">
              <div class="text-5xl mb-2">üåÄ</div>
              <div class="font-bold text-blue-300 text-xl">Paso de Zycurva</div>
              <div class="text-base text-white/80">¬°Activa la conexi√≥n!</div>
            </div>
            <div class="glass-card rounded-2xl p-6 hover:scale-105 transition-transform duration-300">
              <div class="text-5xl mb-2">üï≥Ô∏è</div>
              <div class="font-bold text-purple-300 text-xl">Cr√°ter del Sensorium</div>
              <div class="text-base text-white/80">¬°Detente a tiempo!</div>
            </div>
            <div class="glass-card rounded-2xl p-6 hover:scale-105 transition-transform duration-300">
              <div class="text-5xl mb-2">üöõ</div>
              <div class="font-bold text-green-300 text-xl">Estaci√≥n de Transferencia</div>
              <div class="text-base text-white/80">Transporte en equipo</div>
            </div>
          </div>

          <div class="glass-card rounded-2xl p-6 mb-8">
            <div class="text-2xl font-bold mb-2 text-yellow-300">üéñÔ∏è Logro Desbloqueado</div>
            <div class="text-xl">"Constructor de Robots" - Has dejado tu RoverBot listo para explorar Zython</div>
          </div>

          <button onclick="completeMission0()" class="px-12 py-6 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 hover:from-purple-600 hover:via-pink-600 hover:to-red-600 rounded-2xl font-bold text-2xl transition-all duration-300 transform hover:scale-105 animate-pulse-glow btn-3d btn-premium">
            üöÄ Ir a las Misiones
          </button>
        </div>
      </div>
    </div>

  </div>

  <script>
    'use strict';

    /* =========================
       Audio
    ========================== */
    let audioContext;
    let audioEnabled = true;
    let backgroundMusicInterval;

    function initAudio() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioContext.state === 'suspended') audioContext.resume();
    }

    function playTone(frequency, duration, type = 'square') {
      if (!audioEnabled || !audioContext) return;
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.value = frequency;
      oscillator.type = type;

      gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + duration);
    }

    function playBackgroundMusic() {
      if (!audioEnabled) return;

      const melody = [
        {freq: 523.25, dur: 0.2}, // C5
        {freq: 587.33, dur: 0.2}, // D5
        {freq: 659.25, dur: 0.2}, // E5
        {freq: 698.46, dur: 0.3}, // F5
        {freq: 783.99, dur: 0.2}, // G5
        {freq: 698.46, dur: 0.2}, // F5
        {freq: 659.25, dur: 0.4}, // E5
      ];

      let currentTime = 0;
      melody.forEach(note => {
        setTimeout(() => {
          if (audioEnabled) playTone(note.freq, note.dur, 'sine');
        }, currentTime * 1000);
        currentTime += note.dur + 0.1;
      });
    }

    function startBackgroundMusic() {
      if (backgroundMusicInterval) clearInterval(backgroundMusicInterval);
      playBackgroundMusic();
      backgroundMusicInterval = setInterval(playBackgroundMusic, 3000);
    }

    function stopBackgroundMusic() {
      if (backgroundMusicInterval) {
        clearInterval(backgroundMusicInterval);
        backgroundMusicInterval = null;
      }
    }

    function toggleAudio() {
      audioEnabled = !audioEnabled;
      const button = document.getElementById('audio-toggle');

      if (audioEnabled) {
        button.textContent = 'üîä Audio ON';
        button.classList.add('active');
        initAudio();
        startBackgroundMusic();
        showToast('Audio activado', '¬°Listo para despegar! üîä', 'üîä');
      } else {
        button.textContent = 'üîá Audio OFF';
        button.classList.remove('active');
        stopBackgroundMusic();
        showToast('Audio desactivado', 'Silencio espacial üõ∞Ô∏è', 'üîá');
      }
    }

    document.addEventListener('click', function initOnFirstClick() {
      initAudio();
      startBackgroundMusic();
      document.removeEventListener('click', initOnFirstClick);
    }, { once: true });

    /* =========================
       Estado de la app
    ========================== */
    let currentStep = 0;
    let currentAssemblyStep = 1;
    const totalSteps = 6;
    const totalAssemblySteps = 10;

    /* =========================
       Toast
    ========================== */
    function showToast(title, msg, icon='üèÖ'){
      const t = document.getElementById('toast');
      const tt = document.getElementById('toast-title');
      const tm = document.getElementById('toast-msg');
      const ti = document.getElementById('toast-icon');
      if(!t) return;
      tt.textContent = title;
      tm.textContent = msg;
      ti.textContent = icon;
      t.classList.remove('hidden');
      setTimeout(()=> t.classList.add('hidden'), 2800);
    }

    /* =========================
       Progreso barra superior
    ========================== */
    function updateProgress() {
      const pct = Math.round((currentStep / totalSteps) * 100);
      const bar = document.getElementById('progress-bar');
      const text = document.getElementById('progress-text');
      if (bar) bar.style.width = pct + '%';
      if (text) text.textContent = pct + '%';
    }

    /* =========================
       Paso 0 -> iniciar
    ========================== */
    function startMission() {
      playTone(880, 0.2);
      setTimeout(() => playTone(1047, 0.3), 150);
      currentStep = 1;
      showStep(currentStep);
    }

    /* =========================
       Estrellas + parallax
    ========================== */
    function createStars() {
      const starsContainer = document.getElementById('stars');
      if (!starsContainer) return;
      starsContainer.innerHTML = '';
      for (let i = 0; i < 150; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        const size = Math.random() * 3 + 1;
        star.style.width = size + 'px';
        star.style.height = size + 'px';
        star.style.animationDelay = Math.random() * 3 + 's';
        starsContainer.appendChild(star);
      }
    }

    document.addEventListener('mousemove', (e) => {
      const x = (e.clientX / window.innerWidth - 0.5) * 10;
      const y = (e.clientY / window.innerHeight - 0.5) * 10;
      const stars = document.getElementById('stars');
      if (stars) stars.style.transform = `translate(${x}px, ${y}px)`;
    });

    function createShootingStar() {
      const shootingStar = document.createElement('div');
      shootingStar.className = 'shooting-star';
      shootingStar.style.left = Math.random() * 100 + '%';
      shootingStar.style.top = Math.random() * 50 + '%';
      document.body.appendChild(shootingStar);
      setTimeout(() => shootingStar.remove(), 1000);
    }

    setInterval(() => {
      if (Math.random() > 0.7) createShootingStar();
    }, 3000);

    /* =========================
       Loader premium (step 1)
    ========================== */
    let fakeLoaderInterval = null;

    function startFakeLoader(){
      const bar = document.getElementById('fake-loader');
      const txt = document.getElementById('fake-loader-text');
      if(!bar || !txt) return;

      const msgs = ["Preparando transmisi√≥n‚Ä¶", "Sincronizando estaci√≥n‚Ä¶", "Cargando briefing‚Ä¶"];
      let i = 0, w = 0;

      if(fakeLoaderInterval) clearInterval(fakeLoaderInterval);
      bar.style.width = '0%';
      txt.textContent = msgs[0];

      fakeLoaderInterval = setInterval(() => {
        w = Math.min(w + Math.random() * 18, 100);
        bar.style.width = w + '%';
        txt.textContent = msgs[i++ % msgs.length];
        if (w >= 100) clearInterval(fakeLoaderInterval);
      }, 500);
    }

    /* =========================
       YouTube API
    ========================== */
    let player;
    let videoEnded = false;

    function loadYouTubeAPI() {
      if (typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      }
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('youtube-video', {
        events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange }
      });
    }

    function onPlayerReady() {
      hideLoadingMessage();
      // No forzamos fullscreen: puede bloquearse en navegadores; dejamos UX limpia.
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED && !videoEnded) {
        videoEnded = true;
        onVideoEnd();
      }
    }

    function restartVideo() {
      if (player && player.seekTo) {
        player.seekTo(0);
        player.playVideo();
        videoEnded = false;
        const continueBtn = document.getElementById('continue-btn');
        if (continueBtn && !continueBtn.classList.contains('hidden')) continueBtn.classList.add('hidden');
        showToast('Reiniciando', 'Volvemos a la transmisi√≥n üé¨', 'üîÑ');
      }
    }

    function skipVideo() {
      videoEnded = true;
      onVideoEnd();
      showToast('Video saltado', 'Listo para la misi√≥n üöÄ', '‚è≠Ô∏è');
    }

    function onVideoEnd() {
      const loadingMessage = document.getElementById('loading-message');
      if (loadingMessage) {
        loadingMessage.innerHTML = '‚úÖ Transmisi√≥n completada. ¬°Listo para la misi√≥n!';
        loadingMessage.classList.remove('animate-bounce');
        loadingMessage.classList.add('text-green-400');
        loadingMessage.style.display = 'block';
      }
      const videoControls = document.getElementById('video-controls');
      const continueBtn = document.getElementById('continue-btn');
      if (videoControls) videoControls.classList.add('hidden');
      if (continueBtn) {
        continueBtn.classList.remove('hidden');
        continueBtn.classList.add('animate-fade-in');
      }
    }

    function hideLoadingMessage() {
      const loadingMessage = document.getElementById('loading-message');
      if (loadingMessage) {
        loadingMessage.innerHTML = 'üé¨ ¬°Iniciando transmisi√≥n autom√°ticamente!';
        loadingMessage.classList.add('text-green-400');
      }
      setTimeout(() => {
        const videoControls = document.getElementById('video-controls');
        if (videoControls && videoControls.classList.contains('hidden')) videoControls.classList.remove('hidden');
      }, 3000);
    }

    /* =========================
       Navegaci√≥n entre steps
    ========================== */
    function showStep(stepNumber) {
      for (let i = 0; i <= totalSteps; i++) {
        const step = document.getElementById(`step-${i}`);
        if (!step) continue;
        step.classList.add('hidden');
        step.classList.remove('flex');
      }
      const currentStepElement = document.getElementById(`step-${stepNumber}`);
      if (currentStepElement) {
        currentStepElement.classList.remove('hidden');
        currentStepElement.classList.add('flex');
      }

      // Extras por step
      if(stepNumber === 1) startFakeLoader();

      updateProgress();
      updateHeaderSubtitle(stepNumber);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function updateHeaderSubtitle(stepNumber){
      // Mantiene un "estado" profesional en el header (subt√≠tulo)
      const subtitle = document.querySelector('header .text-xs');
      if(!subtitle) return;

      const map = {
        0: 'Portada',
        1: 'Video de bienvenida',
        2: 'Briefing de misi√≥n',
        3: 'Ensamblaje paso a paso',
        4: 'Robot ensamblado',
        5: 'Conexi√≥n en Scratch',
        6: 'Misi√≥n completada'
      };
      subtitle.textContent = `Misi√≥n 0 ¬∑ ${map[stepNumber] ?? 'En progreso'}`;
    }

    function nextStep() {
      if (currentStep < totalSteps) {
        playTone(660, 0.08, 'sine');
        currentStep++;
        showStep(currentStep);
      }
    }

    /* =========================
       Ensamblaje: dots + persistencia
    ========================== */
    function buildAssemblyDots(){
      const wrap = document.getElementById('assembly-dots');
      if(!wrap) return;
      wrap.innerHTML = '';
      for(let i=1;i<=totalAssemblySteps;i++){
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'w-3 h-3 rounded-full bg-white/20 hover:bg-white/40 transition';
        b.title = `Ir al paso ${i}`;
        b.setAttribute('aria-label', `Ir al paso ${i}`);
        b.onclick = () => jumpToAssemblyStep(i);
        wrap.appendChild(b);
      }
    }

    function highlightAssemblyDots(stepNumber){
      const wrap = document.getElementById('assembly-dots');
      if(!wrap) return;
      const dots = Array.from(wrap.children);
      dots.forEach((d, idx) => {
        const n = idx + 1;
        d.className = 'w-3 h-3 rounded-full transition ' +
          (n === stepNumber ? 'bg-yellow-300' : (n < stepNumber ? 'bg-white/50' : 'bg-white/20 hover:bg-white/40'));
      });
    }

    function persistAssemblyStep(){
      localStorage.setItem('zython-m0-assembly-step', String(currentAssemblyStep));
      const s = document.getElementById('saved-indicator');
      if(s){
        s.textContent = 'guardado';
        s.classList.remove('text-red-300');
        s.classList.add('text-green-300');
        setTimeout(() => {
          s.textContent = 'listo';
          s.classList.remove('text-green-300');
          s.classList.add('text-white/90');
        }, 900);
      }
    }

    function restoreAssemblyStep(){
      const s = Number(localStorage.getItem('zython-m0-assembly-step') || '1');
      currentAssemblyStep = Math.min(Math.max(s,1), totalAssemblySteps);
    }

    function jumpToAssemblyStep(stepNumber){
      currentAssemblyStep = Math.min(Math.max(stepNumber,1), totalAssemblySteps);
      showAssemblyStep(currentAssemblyStep);
      showToast('Navegaci√≥n r√°pida', `Vas al paso ${currentAssemblyStep} ‚öôÔ∏è`, 'üß≠');
    }

    function showAssemblyStep(stepNumber) {
      for (let i = 1; i <= totalAssemblySteps; i++) {
        const step = document.getElementById(`assembly-step-${i}`);
        if (step) step.classList.add('hidden');
      }

      const currentAssemblyStepElement = document.getElementById(`assembly-step-${stepNumber}`);
      if (currentAssemblyStepElement) currentAssemblyStepElement.classList.remove('hidden');

      const stepCounter = document.getElementById('current-step');
      if (stepCounter) stepCounter.textContent = stepNumber;

      highlightAssemblyDots(stepNumber);

      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');

      if (prevBtn) {
        prevBtn.disabled = stepNumber === 1;
        prevBtn.classList.toggle('opacity-50', stepNumber === 1);
      }

      if (nextBtn) {
        if (stepNumber === totalAssemblySteps) {
          nextBtn.textContent = 'Completar ‚úÖ';
          nextBtn.onclick = () => {
            showToast('¬°Listo!', 'Ensamblaje completado ü§ñ', '‚úÖ');
            currentStep = 4;
            showStep(currentStep);
          };
        } else {
          nextBtn.textContent = 'Siguiente ‚Üí';
          nextBtn.onclick = () => nextAssemblyStep();
        }
      }

      persistAssemblyStep();
    }

    function nextAssemblyStep() {
      if (currentAssemblyStep < totalAssemblySteps) {
        playTone(740, 0.06, 'sine');
        currentAssemblyStep++;
        showAssemblyStep(currentAssemblyStep);
      }
    }

    function previousAssemblyStep() {
      if (currentAssemblyStep > 1) {
        playTone(620, 0.06, 'sine');
        currentAssemblyStep--;
        showAssemblyStep(currentAssemblyStep);
      }
    }

    /* =========================
       Activaci√≥n
    ========================== */
    function activateRobot(e) {
      const button = e?.target;
      if (button) {
        button.innerHTML = 'üîÑ Abriendo instrucciones...';
        button.disabled = true;
      }
      setTimeout(() => {
        if (button) {
          button.innerHTML = 'üöÄ Activar Robot en Scratch';
          button.disabled = false;
        }
        showToast('Siguiente paso', 'Vamos a conectarlo en Scratch üß©', 'üß©');
        currentStep = 5;
        showStep(currentStep);
      }, 800);
    }

    /* =========================
       Completar misi√≥n 0 (igual que tu l√≥gica)
    ========================== */
    function completeMission0() {
      const currentPlayer = localStorage.getItem('zython-current-player');
      if (currentPlayer) {
        const stored = localStorage.getItem('zython-players') || '{}';
        const players = JSON.parse(stored);

        if (!players[currentPlayer]) {
          players[currentPlayer] = {
            completedMissions: [0],
            available: 1,
            completed: 1,
            badges: 0,
            currentMission: 1
          };
        } else {
          const p = players[currentPlayer];
          p.completedMissions = Array.isArray(p.completedMissions) ? p.completedMissions : [];
          if (!p.completedMissions.includes(0)) p.completedMissions.push(0);
          p.available = 1;
          p.completed = 1;
          p.currentMission = 1;
        }

        localStorage.setItem('zython-players', JSON.stringify(players));
      }

      showToast('Logro desbloqueado', 'Constructor de Robots ‚úÖ', 'üèÖ');
      setTimeout(() => window.location.href = 'index.html', 700);
    }

    /* =========================
       Inicializaci√≥n
    ========================== */
    function initializeApp() {
      createStars();
      buildAssemblyDots();

      restoreAssemblyStep();
      showStep(0);
      showAssemblyStep(currentAssemblyStep);

      loadYouTubeAPI();

      // Failsafe si el video no dispara end
      setTimeout(() => {
        if (!videoEnded && currentStep === 1) onVideoEnd();
      }, 180000);

      updateProgress();
      updateHeaderSubtitle(0);
    }

    window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>
```
