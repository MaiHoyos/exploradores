<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misi√≥n 2: RoverBot en Zycurva ‚Äì Evita el Abismo</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Fredoka', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* Fondo animado con gradiente din√°mico */
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        body {
            background: linear-gradient(-45deg, #1a0a3e, #2d1b69, #0f172a, #1e293b);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        /* Estrellas mejoradas con brillo */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* Estrellas fugaces ocasionales */
        @keyframes shootingStar {
            0% {
                transform: translateX(0) translateY(0) rotate(-45deg);
                opacity: 1;
            }
            100% {
                transform: translateX(-300px) translateY(300px) rotate(-45deg);
                opacity: 0;
            }
        }

        .shooting-star {
            position: absolute;
            width: 2px;
            height: 60px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 1));
            animation: shootingStar 1s ease-out;
            pointer-events: none;
        }

        /* Transiciones suaves entre slides */
        .slide {
            display: none;
            animation: fadeInScale 0.5s ease-out;
        }

        .slide.active {
            display: block;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Efecto vidrio esmerilado */
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* Botones 3D mejorados */
        .btn-3d {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 0 20px rgba(251, 191, 36, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-3d:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3), 0 0 30px rgba(251, 191, 36, 0.6);
        }

        .btn-3d:active {
            transform: translateY(0);
        }

        /* Efecto pulso en badges */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .badge-pulse {
            animation: pulse 2s infinite;
        }

        /* Inputs mejorados */
        input[type="number"], input[type="text"] {
            background: rgba(15,23,42,0.9);
            border-radius: 0.5rem;
            padding: 0.5rem;
            border: 2px solid rgba(251, 191, 36, 0.3);
            width: 100%;
            color: #fbbf24;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        input[type="number"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: rgba(251, 191, 36, 0.8);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
        }

        /* Tabla mejorada */
        .table-row {
            transition: all 0.2s ease;
        }

        .table-row:hover {
            background: rgba(251, 191, 36, 0.1);
            transform: scale(1.01);
        }

        /* Bot√≥n de audio */
        .audio-toggle {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 1000;
            background: rgba(251, 191, 36, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 0.75rem 1.25rem;
            border-radius: 9999px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }

        .audio-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(251, 191, 36, 0.6);
        }

        .audio-toggle.active {
            background: rgba(16, 185, 129, 0.9);
        }

        /* Optimizaciones m√≥vil 360x800px */
        @media (max-width: 640px) {
            header {
                padding: 0.75rem !important;
                margin: 0.5rem !important;
            }
            
            h2, h3 {
                font-size: 1rem !important;
                line-height: 1.3;
            }
            
            p, li {
                font-size: 0.8rem !important;
                line-height: 1.4;
            }
            
            .glass-card {
                padding: 0.875rem !important;
            }
            
            table {
                font-size: 0.625rem !important;
            }
            
            th, td {
                padding: 0.25rem !important;
            }
            
            button {
                padding: 0.5rem 1rem !important;
                font-size: 0.75rem !important;
            }
            
            .grid {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>
<body class="min-h-screen text-white relative overflow-auto">
<div class="stars" id="stars"></div>

<!-- Bot√≥n de control de audio -->
<button id="audio-toggle" class="audio-toggle active" onclick="toggleAudio()">
    üîä Audio ON
</button>

<header class="relative z-10 glass-card bg-gradient-to-r from-blue-500/80 to-blue-600/80 rounded-b-3xl p-4 md:p-6 m-3 md:m-4">
    <div class="flex items-center justify-between">
        <button onclick="volverAMisiones()" class="px-4 py-2 bg-white text-blue-600 font-bold rounded-full shadow-lg btn-3d">
            ‚Üê Volver a Misiones
        </button>
        <div class="flex items-center space-x-3 md:space-x-4">
            <div class="text-xl md:text-3xl font-extrabold text-white drop-shadow-lg" style="text-shadow: 0 0 20px rgba(251, 191, 36, 0.6);">MISI√ìN 2</div>
            <div class="text-3xl md:text-4xl text-yellow-300">‚ö†Ô∏è</div>
        </div>
        <div id="completion-badge" class="hidden px-3 md:px-4 py-2 bg-green-500 text-white font-bold rounded-full shadow-lg text-xs md:text-sm badge-pulse">
            ‚≠ê Insignia ganada
        </div>
    </div>
    <p class="mt-2 md:mt-3 text-xs md:text-base text-white/90 text-right">
        Planeta Zycurva ¬∑ Uso del sensor de movimiento ¬∑ Pensamiento matem√°tico y computacional
    </p>
</header>

<main class="relative z-10 p-4 md:p-10 max-w-4xl mx-auto">
    <section class="glass-card rounded-3xl p-4 md:p-8 shadow-2xl mb-6 md:mb-8">

        <!-- Indicador -->
        <div class="flex items-center justify-between mb-3 md:mb-4">
            <h2 class="text-lg md:text-3xl font-bold text-yellow-300">
                RoverBot en Zycurva: Evita el Abismo
            </h2>
            <div id="slide-indicator" class="text-xs md:text-sm text-white/80">
                Diapositiva <span id="current-slide">1</span> de <span id="total-slides">8</span>
            </div>
        </div>

        <!-- SLIDE 1: Introducci√≥n -->
        <div class="slide active" data-slide="1">
            <p class="text-sm md:text-lg text-white/90 mb-3 md:mb-4">
                Has llegado al <span class="font-semibold text-yellow-300">Planeta Zycurva</span>, una superficie inestable llena de grietas profundas y abismos energ√©ticos.
                Tu explorador, <span class="font-semibold">RoverBot</span>, solo puede avanzar y retroceder en l√≠nea recta, pero un paso en falso puede hacerlo caer al vac√≠o.
            </p>
            <p class="text-sm md:text-base text-white/90 mb-3 md:mb-4">
                Tu misi√≥n es convertir el <span class="font-semibold">sensor de movimiento</span> de RoverBot en su sistema de seguridad:
                un aliado que le avise cu√°ndo detenerse antes del borde.
            </p>
            <div class="mt-4 md:mt-6">
                <div class="w-full aspect-video flex items-center justify-center rounded-2xl border-2 border-dashed border-white/40 text-white/60 text-center text-xs md:text-sm p-4">
                    Espacio para ilustraci√≥n de portada (RoverBot frente al abismo en Zycurva).
                </div>
            </div>
        </div>

        <!-- SLIDE 2: Preparaci√≥n (con imagen 7) -->
        <div class="slide" data-slide="2">
            <h3 class="text-lg md:text-xl font-semibold text-yellow-300 mb-2 md:mb-3">1. Preparaci√≥n en Zycurva</h3>
            <p class="text-sm md:text-base text-white/90 mb-2 md:mb-3">
                Antes de enviar a RoverBot hacia el borde, prepara el escenario de forma segura:
            </p>
            <ul class="list-disc list-inside space-y-1 md:space-y-2 text-xs md:text-base text-white/85 mb-3 md:mb-4">
                <li>Marca una <span class="font-semibold">l√≠nea de inicio</span> para RoverBot.</li>
                <li>Delimita el <span class="font-semibold">abismo</span> con cinta o cartulina oscura.</li>
                <li>Asegura que RoverBot solo pueda avanzar y retroceder en l√≠nea recta.</li>
                <li>Conecta el hub y comprueba motor y sensor de movimiento.</li>
                <li>Abre el entorno de programaci√≥n por bloques.</li>
            </ul>
            <div class="mt-3 md:mt-4">
                <img src="Sensor/7.jpg"
                     class="w-full rounded-2xl border-4 border-white/40 shadow-xl transition-all duration-300 hover:scale-[1.02]"
                     alt="Sensor montado en RoverBot (vista general)">
            </div>
        </div>

        <!-- SLIDE 3: Construcci√≥n del sensor ‚Äì Parte 1 (pasos 1-3) -->
        <div class="slide" data-slide="3">
            <h3 class="text-lg md:text-xl font-semibold text-yellow-300 mb-2 md:mb-3">2. Construcci√≥n del Sensor ‚Äì Parte 1</h3>
            <p class="text-sm md:text-base text-white/90 mb-2 md:mb-3">
                Construye el <span class="font-semibold">brazo con sensor</span> que ayudar√° a RoverBot a detectar el borde.
                Sigue las im√°genes en orden.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-3">
                <div class="flex flex-col items-center text-xs text-white/70">
                    <img src="Sensor/1.jpg" class="w-full rounded-xl border border-white/30 mb-1 transition-all duration-300 hover:scale-105" alt="Paso 1 Sensor">
                    <span>Paso 1</span>
                </div>
                <div class="flex flex-col items-center text-xs text-white/70">
                    <img src="Sensor/2.jpg" class="w-full rounded-xl border border-white/30 mb-1 transition-all duration-300 hover:scale-105" alt="Paso 2 Sensor">
                    <span>Paso 2</span>
                </div>
                <div class="flex flex-col items-center text-xs text-white/70">
                    <img src="Sensor/3.jpg" class="w-full rounded-xl border border-white/30 mb-1 transition-all duration-300 hover:scale-105" alt="Paso 3 Sensor">
                    <span>Paso 3</span>
                </div>
            </div>
            <p class="mt-3 md:mt-4 text-white/80 text-xs md:text-sm">
                Aseg√∫rense de que las piezas queden firmes: este ser√° el brazo de vigilancia de RoverBot.
            </p>
        </div>

        <!-- SLIDE 4: Construcci√≥n del sensor ‚Äì Parte 2 (pasos 4-7) -->
        <div class="slide" data-slide="4">
            <h3 class="text-lg md:text-xl font-semibold text-yellow-300 mb-2 md:mb-3">2. Construcci√≥n del Sensor ‚Äì Parte 2</h3>
            <p class="text-sm md:text-base text-white/90 mb-2 md:mb-3">
                Completa la estructura del sensor hasta el paso 7. El sensor debe quedar orientado hacia el frente.
            </p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3">
                <div class="flex flex-col items-center text-xs text-white/70">
                    <img src="Sensor/4.jpg" class="w-full rounded-xl border border-white/30 mb-1 transition-all duration-300 hover:scale-105" alt="Paso 4 Sensor">
                    <span>Paso 4</span>
                </div>
                <div class="flex flex-col items-center text-xs text-white/70">
                    <img src="Sensor/5.jpg" class="w-full rounded-xl border border-white/30 mb-1 transition-all duration-300 hover:scale-105" alt="Paso 5 Sensor">
                    <span>Paso 5</span>
                </div>
                <div class="flex flex-col items-center text-xs text-white/70">
                    <img src="Sensor/6.jpg" class="w-full rounded-xl border border-white/30 mb-1 transition-all duration-300 hover:scale-105" alt="Paso 6 Sensor">
                    <span>Paso 6</span>
                </div>
                <div class="flex flex-col items-center text-xs text-white/70">
                    <img src="Sensor/7.jpg" class="w-full rounded-xl border border-white/30 mb-1 transition-all duration-300 hover:scale-105" alt="Paso 7 Sensor">
                    <span>Paso 7</span>
                </div>
            </div>
            <p class="mt-3 md:mt-4 text-white/75 text-[10px] md:text-xs">
                Im√°genes basadas en instrucciones LEGO¬Æ Education WeDo 2.0. Uso educativo.
            </p>
        </div>

        <!-- SLIDE 5: Fase Explorar -->
        <div class="slide" data-slide="5">
            <h3 class="text-lg md:text-xl font-semibold text-yellow-300 mb-2 md:mb-3">3. Fase Explorar</h3>
            <p class="text-sm md:text-base text-white/90 mb-2 md:mb-3">
                Con RoverBot listo, tu equipo reflexiona:
            </p>
            <ul class="list-disc list-inside space-y-1 md:space-y-2 text-xs md:text-base text-white/85 mb-3 md:mb-4">
                <li>Si un robot no ve como nosotros, ¬øc√≥mo puede saber que est√° cerca de un lugar peligroso?</li>
                <li>¬øQu√© pasar√≠a si RoverBot no se detiene a tiempo antes del abismo?</li>
                <li>¬øPor qu√© los cient√≠ficos necesitan medir con precisi√≥n para tomar decisiones seguras?</li>
            </ul>
            <p class="text-xs md:text-base text-white/80 mb-2">
                El sensor es un <span class="font-semibold">"ojo cient√≠fico"</span> y el programa ser√° un
                <span class="font-semibold">algoritmo</span>: una lista ordenada de instrucciones claras.
            </p>
            <p class="text-xs md:text-base text-white/80 font-semibold">
                üíæ Escriban sus respuestas en un documento Word titulado
                "M2_Zycurva_FaseExplorar_NombreEquipo" y gu√°rdenlo en la carpeta de la misi√≥n en Drive.
            </p>
            <div class="mt-3 md:mt-4">
                <div class="w-full h-32 md:h-40 flex items-center justify-center rounded-2xl border-2 border-dashed border-white/40 text-white/60 text-center text-xs md:text-sm p-4">
                    Espacio para ilustraci√≥n del equipo reflexionando sobre RoverBot.
                </div>
            </div>
        </div>

        <!-- SLIDE 6: Fase Crear (pseudoc√≥digo) -->
        <div class="slide" data-slide="6">
            <h3 class="text-lg md:text-xl font-semibold text-yellow-300 mb-2 md:mb-3">4. Fase Crear: Algoritmo de Seguridad</h3>
            <p class="text-sm md:text-base text-white/90 mb-2 md:mb-3">
                Antes de programar con bloques, escriban el <span class="font-semibold">pseudoc√≥digo</span>:
                qu√© debe hacer RoverBot paso a paso para no caer.
            </p>
            <pre class="bg-black/70 text-[10px] md:text-sm p-3 rounded-xl border border-white/10 whitespace-pre-wrap text-white/90">
AL INICIAR:
  MIENTRAS RoverBot EST√â LEJOS DEL BORDE:
      AVANZAR
      LEER SENSOR
  SI EL SENSOR DETECTA BORDE:
      DETENER MOTOR
      HACER SONIDO DE ALERTA
      RETROCEDER 2 SEGUNDOS
            </pre>
            <p class="text-xs md:text-base text-white/80 font-semibold mt-2">
                ‚úçÔ∏è Escriban su propia versi√≥n de pseudoc√≥digo en el documento de la misi√≥n
                antes de pasar a la programaci√≥n por bloques.
            </p>
            <div class="mt-3 md:mt-4">
                <div class="w-full aspect-video flex items-center justify-center rounded-2xl border-2 border-dashed border-white/40 text-white/60 text-center text-xs md:text-sm p-4">
                    Espacio para diagrama de flujo o esquema del algoritmo del equipo.
                </div>
            </div>
        </div>

        <!-- SLIDE 7: Registrar y Analizar -->
        <div class="slide" data-slide="7">
            <h3 class="text-lg md:text-xl font-semibold text-yellow-300 mb-2 md:mb-3">5. Registrar y Analizar: ¬øEs un programa seguro?</h3>
            <p class="text-sm md:text-base text-white/90 mb-2 md:mb-3">
                Ahora deben comprobar con datos si el programa protege a RoverBot:
            </p>
            <ul class="list-disc list-inside space-y-1 md:space-y-2 text-xs md:text-base text-white/85 mb-3 md:mb-4">
                <li>Midan la distancia desde la l√≠nea de inicio hasta el abismo (ej. 40 cm).</li>
                <li>Ejecuten el programa varias veces.</li>
                <li>Registren en la tabla d√≥nde se detuvo RoverBot.</li>
            </ul>
            <div class="overflow-x-auto mb-3">
                <table class="w-full text-[10px] md:text-sm text-left border border-white/20 rounded-xl overflow-hidden">
                    <thead class="bg-white/10">
                    <tr>
                        <th class="px-2 py-1 border-b border-white/20">Ensayo</th>
                        <th class="px-2 py-1 border-b border-white/20">Distancia al borde (cm)</th>
                        <th class="px-2 py-1 border-b border-white/20">D√≥nde se detuvo (cm)</th>
                        <th class="px-2 py-1 border-b border-white/20">¬øSe detuvo a tiempo?</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="table-row">
                        <td class="px-2 py-1 border-b border-white/10">1</td>
                        <td class="px-2 py-1 border-b border-white/10"><input type="number" placeholder="40"></td>
                        <td class="px-2 py-1 border-b border-white/10"><input type="number"></td>
                        <td class="px-2 py-1 border-b border-white/10"><input type="text" placeholder="S√≠ / No"></td>
                    </tr>
                    <tr class="table-row">
                        <td class="px-2 py-1 border-b border-white/10">2</td>
                        <td class="px-2 py-1 border-b border-white/10"><input type="number" placeholder="40"></td>
                        <td class="px-2 py-1 border-b border-white/10"><input type="number"></td>
                        <td class="px-2 py-1 border-b border-white/10"><input type="text" placeholder="S√≠ / No"></td>
                    </tr>
                    <tr class="table-row">
                        <td class="px-2 py-1 border-b border-white/10">3</td>
                        <td class="px-2 py-1 border-b border-white/10"><input type="number" placeholder="40"></td>
                        <td class="px-2 py-1 border-b border-white/10"><input type="number"></td>
                        <td class="px-2 py-1 border-b border-white/10"><input type="text" placeholder="S√≠ / No"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <p class="text-xs md:text-base text-white/80 font-semibold">
                Analicen si RoverBot siempre se detiene a una distancia segura.
                Si no, ajusten el programa y registren sus conclusiones en el documento en Drive.
            </p>
        </div>

        <!-- SLIDE 8: Compartir -->
        <div class="slide" data-slide="8">
            <h3 class="text-lg md:text-xl font-semibold text-yellow-300 mb-2 md:mb-3">6. Fase Compartir: Informe de la Misi√≥n</h3>
            <ul class="list-disc list-inside space-y-1 md:space-y-2 text-xs md:text-base text-white/85 mb-3 md:mb-4">
                <li>Graben un v√≠deo donde se vea a RoverBot acerc√°ndose al abismo y deteni√©ndose a tiempo.</li>
                <li>En el v√≠deo, expliquen:
                    <ul class="list-disc list-inside ml-4 md:ml-5 space-y-1">
                        <li>C√≥mo usa RoverBot el sensor de movimiento.</li>
                        <li>Qu√© instrucciones del algoritmo lo protegen.</li>
                        <li>Qu√© observaron en la tabla de datos.</li>
                    </ul>
                </li>
                <li>Suban el v√≠deo y el documento de la misi√≥n a la carpeta en Drive.</li>
            </ul>
            <p class="text-xs md:text-base text-white/80 font-semibold mb-3 md:mb-4">
                ‚úÖ Cuando terminen, hagan clic en <span class="underline">"Completar Misi√≥n"</span> para ganar la insignia
                <span class="text-yellow-300">"Guardianes del Abismo de Zycurva"</span>.
            </p>
            <div class="flex flex-wrap justify-center gap-3 md:gap-4">
                <button id="complete-btn" onclick="completeMission()" class="px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-green-500 to-green-700 text-white font-bold text-sm md:text-lg rounded-full shadow-lg btn-3d">
                    Completar Misi√≥n
                </button>
                <a href="index.html" id="completed-btn" class="hidden px-4 md:px-6 py-2 md:py-3 bg-white text-green-600 font-bold text-sm md:text-lg rounded-full shadow-lg btn-3d">
                    Volver a Misiones
                </a>
            </div>
        </div>

        <!-- Controles -->
        <div class="mt-6 md:mt-8 flex justify-between items-center">
            <button id="prev-slide" class="px-3 md:px-4 py-2 glass-card border border-white/40 rounded-full text-white/80 text-xs md:text-sm btn-3d transition" onclick="changeSlide(-1)">
                ‚Üê Anterior
            </button>
            <button id="next-slide" class="px-3 md:px-4 py-2 bg-blue-500 rounded-full text-white font-semibold text-xs md:text-sm btn-3d transition" onclick="changeSlide(1)">
                Siguiente ‚Üí
            </button>
        </div>

    </section>
</main>

<script>
    function createStars() {
        const starsContainer = document.getElementById('stars');
        if (!starsContainer) return;
        for (let i = 0; i < 150; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            const size = Math.random() * 3 + 1;
            star.style.width = size + 'px';
            star.style.height = size + 'px';
            star.style.animationDelay = Math.random() * 3 + 's';
            starsContainer.appendChild(star);
        }
    }

    function createShootingStar() {
        const starsContainer = document.getElementById('stars');
        if (!starsContainer) return;
        
        const shootingStar = document.createElement('div');
        shootingStar.className = 'shooting-star';
        shootingStar.style.left = Math.random() * 100 + '%';
        shootingStar.style.top = Math.random() * 50 + '%';
        starsContainer.appendChild(shootingStar);
        
        setTimeout(() => shootingStar.remove(), 1000);
    }

    function volverAMisiones() {
        window.location.href = 'index.html';
    }

    function getCurrentPlayer() {
        return localStorage.getItem('zython-current-player');
    }

    function loadPlayerProgress(playerName) {
        try {
            const players = JSON.parse(localStorage.getItem('zython-players') || '{}');
            return players[playerName] || { completedMissions: [], completed: 0, currentMission: 1, available: 1, badges: 0 };
        } catch (e) {
            console.error('Error loading progress', e);
            return { completedMissions: [], completed: 0, currentMission: 1, available: 1, badges: 0 };
        }
    }

    function savePlayerProgress(playerName, progress) {
        try {
            const players = JSON.parse(localStorage.getItem('zython-players') || '{}');
            players[playerName] = progress;
            localStorage.setItem('zython-players', JSON.stringify(players));
        } catch (e) {
            console.error('Error saving progress', e);
        }
    }

    function checkCompletion() {
        const currentPlayer = getCurrentPlayer();
        if (!currentPlayer) return;
        const progress = loadPlayerProgress(currentPlayer);
        if (progress.completedMissions.includes(2)) {
            const badge = document.getElementById('completion-badge');
            const completeBtn = document.getElementById('complete-btn');
            const completedBtn = document.getElementById('completed-btn');
            if (badge) badge.classList.remove('hidden');
            if (completeBtn) completeBtn.classList.add('hidden');
            if (completedBtn) completedBtn.classList.remove('hidden');
        }
    }

    function completeMission() {
        const currentPlayer = getCurrentPlayer();
        if (!currentPlayer) {
            alert('Error: No se encontr√≥ informaci√≥n del jugador. Regresa al men√∫ principal.');
            return;
        }
        const progress = loadPlayerProgress(currentPlayer);
        if (!progress.completedMissions.includes(2)) {
            progress.completedMissions.push(2);
            progress.completed = progress.completedMissions.length;
            progress.badges = progress.completedMissions.length;
            progress.currentMission = 3;
            progress.available = Math.max(progress.available, 3);
            savePlayerProgress(currentPlayer, progress);
        }
        const badge = document.getElementById('completion-badge');
        const completeBtn = document.getElementById('complete-btn');
        const completedBtn = document.getElementById('completed-btn');
        if (badge) badge.classList.remove('hidden');
        if (completeBtn) completeBtn.classList.add('hidden');
        if (completedBtn) completedBtn.classList.remove('hidden');
        alert('¬°Misi√≥n completada! Has obtenido la insignia "Guardianes del Abismo de Zycurva". La Misi√≥n 3 ahora est√° disponible.');
    }

    let currentSlide = 1;

    function updateSlideVisibility() {
        const slides = document.querySelectorAll('.slide');
        const total = slides.length;
        slides.forEach(slide => {
            const n = parseInt(slide.getAttribute('data-slide'));
            slide.classList.toggle('active', n === currentSlide);
        });

        const currentSpan = document.getElementById('current-slide');
        const totalSpan = document.getElementById('total-slides');
        if (currentSpan) currentSpan.textContent = currentSlide;
        if (totalSpan) totalSpan.textContent = total;

        const prevBtn = document.getElementById('prev-slide');
        const nextBtn = document.getElementById('next-slide');

        if (currentSlide === 1) {
            prevBtn.classList.add('invisible');
        } else {
            prevBtn.classList.remove('invisible');
        }

        if (currentSlide === total) {
            nextBtn.classList.add('hidden');
        } else {
            nextBtn.classList.remove('hidden');
        }
    }

    function changeSlide(delta) {
        const slides = document.querySelectorAll('.slide');
        const total = slides.length;
        currentSlide += delta;
        if (currentSlide < 1) currentSlide = 1;
        if (currentSlide > total) currentSlide = total;
        updateSlideVisibility();
    }

    // Sistema de audio 8-bit
    let audioContext;
    let audioEnabled = true;
    let backgroundMusicInterval;
    
    function initAudio() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }
    }
    
    function playTone(frequency, duration, type = 'square') {
        if (!audioEnabled || !audioContext) return;
        
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = frequency;
        oscillator.type = type;
        
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
    }
    
    function playBackgroundMusic() {
        if (!audioEnabled) return;
        
        const melody = [
            {freq: 523.25, dur: 0.2},
            {freq: 587.33, dur: 0.2},
            {freq: 659.25, dur: 0.2},
            {freq: 698.46, dur: 0.3},
            {freq: 783.99, dur: 0.2},
            {freq: 698.46, dur: 0.2},
            {freq: 659.25, dur: 0.4},
        ];
        
        let currentTime = 0;
        melody.forEach(note => {
            setTimeout(() => {
                if (audioEnabled) playTone(note.freq, note.dur, 'sine');
            }, currentTime * 1000);
            currentTime += note.dur + 0.1;
        });
    }
    
    function startBackgroundMusic() {
        if (backgroundMusicInterval) clearInterval(backgroundMusicInterval);
        playBackgroundMusic();
        backgroundMusicInterval = setInterval(playBackgroundMusic, 3000);
    }
    
    function stopBackgroundMusic() {
        if (backgroundMusicInterval) {
            clearInterval(backgroundMusicInterval);
            backgroundMusicInterval = null;
        }
    }
    
    function toggleAudio() {
        audioEnabled = !audioEnabled;
        const button = document.getElementById('audio-toggle');
        
        if (audioEnabled) {
            button.textContent = 'üîä Audio ON';
            button.classList.add('active');
            initAudio();
            startBackgroundMusic();
        } else {
            button.textContent = 'üîá Audio OFF';
            button.classList.remove('active');
            stopBackgroundMusic();
        }
    }
    
    document.addEventListener('click', function initOnFirstClick() {
        initAudio();
        startBackgroundMusic();
        document.removeEventListener('click', initOnFirstClick);
    }, { once: true });

    function initialize() {
        createStars();
        checkCompletion();
        updateSlideVisibility();
        setInterval(createShootingStar, 5000);
    }

    document.addEventListener('DOMContentLoaded', initialize);
</script>
</body>
</html>
