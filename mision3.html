<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misi√≥n 3: Corredor de Cr√°teres del Sensorium</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Exo 2', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .sheet-title {
            font-family: 'Orbitron', sans-serif;
        }

        textarea {
            resize: vertical;
        }

        .sheet {
            display: none;
        }

        .sheet.active {
            display: flex;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-purple-900 via-blue-900 to-black text-white relative overflow-hidden">
    <div class="stars" id="stars"></div>
    
    <!-- HEADER -->
    <header class="relative z-20 bg-gradient-to-r from-purple-400 to-purple-600 border-4 border-white rounded-b-3xl p-4 md:p-6 m-3 md:m-4">
        <div class="flex flex-wrap items-center justify-between gap-4">
            <button onclick="volverAMisiones()" class="px-4 py-2 bg-white text-purple-600 font-bold rounded-full shadow-lg transition-transform transform hover:scale-105">
                ‚Üê Volver a Misiones
            </button>
            <div class="flex items-center gap-3">
                <div class="text-2xl md:text-3xl font-extrabold text-white drop-shadow-lg">MISI√ìN 3 ¬∑ Sensorium</div>
                <div class="text-3xl md:text-4xl">üååü§ù</div>
            </div>
            <div id="completion-badge" class="hidden px-4 py-2 bg-green-500 text-white font-bold rounded-full shadow-lg text-xs md:text-sm">
                üèÖ Insignia: Colaboraci√≥n en Sensorium
            </div>
        </div>
        <div class="mt-1 text-[10px] md:text-xs text-purple-100 text-right">
            Hoja <span id="sheet-indicator">1</span> de <span id="sheet-total">9</span>
        </div>
    </header>

    <!-- MAIN -->
    <main class="relative z-10 px-4 md:px-8 max-w-5xl mx-auto">
        <!-- CONTENEDOR DE HOJAS (pantalla fija) -->
        <div id="sheet-container" class="h-[calc(100vh-220px)] flex items-center justify-center">
            <!-- HOJA 1: HISTORIA Y OBJETIVOS -->
            <section id="sheet-1" class="sheet active w-full max-w-5xl h-full bg-white/10 backdrop-blur-sm rounded-3xl p-4 md:p-6 border-4 border-white/30 shadow-2xl flex-col justify-center space-y-3">
                <h2 class="sheet-title text-xl md:text-2xl font-bold text-center mb-1 text-yellow-300">
                    Hoja 1 ¬∑ Corredor de Cr√°teres del Sensorium
                </h2>
                <p class="text-xs md:text-sm text-white/90 text-center px-2">
                    En el planeta <span class="font-bold text-teal-300">Sensorium</span>, dos RoverBots deben colaborar para transportar una valiosa muestra de energ√≠a
                    hasta un punto exacto del mapa. El camino est√° lleno de cr√°teres y zonas inestables. 
                    Solo lo lograr√°n si planifican <span class="font-semibold text-yellow-300">trayectorias con giros y √°ngulos precisos</span> 
                    y trabajan como un equipo cient√≠fico.
                </p>

                <div class="grid grid-cols-2 gap-3 items-center mt-2">
                    <div>
                        <img src="mision3_sensorium.png"
                            alt="Corredor de cr√°teres en Sensorium"
                            class="w-full rounded-2xl border-2 border-white/60 shadow-xl"
                            onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=&quot;w-full aspect-video flex items-center justify-center text-3xl bg-gradient-to-br from-purple-500 via-blue-500 to-black rounded-2xl border-2 border-white/40&quot;>üååüï≥Ô∏èüï≥Ô∏è</div>'">
                    </div>
                    <div class="bg-black/40 p-3 rounded-2xl border-2 border-white/40 space-y-1 text-[10px] md:text-xs">
                        <h3 class="text-sm md:text-base font-semibold text-white mb-1">Objetivo de la misi√≥n</h3>
                        <ul class="list-disc list-inside text-white/90 space-y-1">
                            <li>Unir dos RoverBots para transportar una misma carga.</li>
                            <li>Dise√±ar un recorrido con cambios de direcci√≥n y √°ngulos.</li>
                            <li>Esquivar cr√°teres y zonas peligrosas.</li>
                            <li>Detenerse exactamente en el punto de entrega marcado.</li>
                        </ul>
                    </div>
                </div>

                <div class="mt-2 space-y-1 text-[10px] md:text-xs">
                    <p class="font-semibold text-purple-300">Conceptos matem√°ticos:</p>
                    <ul class="list-disc list-inside text-white/90 space-y-1">
                        <li>Distancias en cent√≠metros o cuadros.</li>
                        <li>√Ångulos (90¬∞, 45¬∞, 135¬∞, 180¬∞).</li>
                        <li>Relaci√≥n potencia‚Äìtiempo‚Äìdistancia.</li>
                        <li>Recorridos en un plano (trayectorias).</li>
                    </ul>
                </div>
            </section>

            <!-- HOJA 2: ESCENARIO + PSEUDOC√ìDIGO -->
            <section id="sheet-2" class="sheet w-full max-w-5xl h-full bg-white/10 backdrop-blur-sm rounded-3xl p-4 md:p-6 border-4 border-indigo-300/40 shadow-2xl flex-col justify-center space-y-3">
                <h2 class="sheet-title text-xl md:text-2xl font-bold text-yellow-300 text-center mb-1">
                    Hoja 2 ¬∑ Dise√±a tu trayectoria segura en Sensorium
                </h2>
                <p class="text-[10px] md:text-xs text-white/90 px-2 text-center">
                    STEAM Time üé®: En equipos, <span class="font-semibold text-teal-300">crea el escenario</span> de Sensorium:
                    dibuja o construye con papel, cartulina o materiales simples los cr√°teres, monta√±as, rocas y el terreno.
                </p>
                <ul class="list-disc list-inside text-[10px] md:text-xs text-white/90 px-4 space-y-1">
                    <li>Marca el <span class="font-semibold">Punto A</span>: lugar de partida de los RoverBots.</li>
                    <li>La profe se√±alar√° el <span class="font-semibold">Punto B</span>: lugar exacto donde deben entregar la muestra.</li>
                    <li>Dibuja al menos <span class="font-semibold">2 cr√°teres</span> que deben esquivar.</li>
                </ul>

                <div class="bg-black/40 rounded-2xl border border-white/30 p-3 space-y-2 text-[10px] md:text-xs">
                    <p class="font-semibold text-yellow-300">Ahora escribe el plan en tus palabras (pseudoc√≥digo):</p>
                    <p>1Ô∏è‚É£ Coloca los RoverBots en el Punto A.</p>
                    <p>2Ô∏è‚É£ Observa el escenario y piensa: ¬øcu√°ntos pasos rectos?, ¬ød√≥nde girar?, ¬øqu√© √°ngulos usar?</p>
                    <p>3Ô∏è‚É£ En un archivo Word (Misi√≥n 3 - Sensorium), escribe con tus palabras el pseudoc√≥digo, por ejemplo:</p>
                    <ul class="list-disc list-inside ml-3">
                        <li>Ir recto 5 cuadros.</li>
                        <li>Girar 90¬∞ a la derecha.</li>
                        <li>Ir recto 3 cuadros.</li>
                        <li>Girar 45¬∞ a la izquierda.</li>
                        <li>Continuar hasta el Punto B.</li>
                    </ul>
                    <p>4Ô∏è‚É£ Guarda ese archivo en la carpeta de la Misi√≥n 3 en el Drive del curso.</p>
                </div>
            </section>

            <!-- HOJA 3: CONSTRUCCI√ìN 1-3 -->
            <section id="sheet-3" class="sheet w-full max-w-5xl h-full bg-white/10 backdrop-blur-sm rounded-3xl p-4 border-4 border-pink-300/40 shadow-2xl flex-col justify-center space-y-3">
                <h2 class="sheet-title text-xl md:text-2xl font-bold text-yellow-300 text-center mb-1">
                    Hoja 3 ¬∑ Construcci√≥n (Pasos 1-3)
                </h2>
                <p class="text-[10px] md:text-xs text-center text-white/90">
                    Sigan las im√°genes para iniciar el m√≥dulo que une a los dos RoverBots.
                </p>
                <div class="grid grid-cols-3 gap-3">
                    <img src="Colaboraci√≥n/1.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 1" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/2.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 2" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/3.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 3" onerror="this.style.display='none';">
                </div>
            </section>

            <!-- HOJA 4: CONSTRUCCI√ìN 4-6 -->
            <section id="sheet-4" class="sheet w-full max-w-5xl h-full bg-white/10 backdrop-blur-sm rounded-3xl p-4 border-4 border-pink-300/40 shadow-2xl flex-col justify-center space-y-3">
                <h2 class="sheet-title text-xl md:text-2xl font-bold text-yellow-300 text-center mb-1">
                    Hoja 4 ¬∑ Construcci√≥n (Pasos 4-6)
                </h2>
                <p class="text-[10px] md:text-xs text-center text-white/90">
                    Refuerza la base para que el m√≥dulo sea estable.
                </p>
                <div class="grid grid-cols-3 gap-3">
                    <img src="Colaboraci√≥n/4.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 4" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/5.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 5" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/6.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 6" onerror="this.style.display='none';">
                </div>
            </section>

            <!-- HOJA 5: CONSTRUCCI√ìN 7-9 -->
            <section id="sheet-5" class="sheet w-full max-w-5xl h-full bg-white/10 backdrop-blur-sm rounded-3xl p-4 border-4 border-pink-300/40 shadow-2xl flex-col justify-center space-y-3">
                <h2 class="sheet-title text-xl md:text-2xl font-bold text-yellow-300 text-center mb-1">
                    Hoja 5 ¬∑ Construcci√≥n (Pasos 7-9)
                </h2>
                <p class="text-[10px] md:text-xs text-center text-white/90">
                    Ajusta el soporte de la carga compartida.
                </p>
                <div class="grid grid-cols-3 gap-3">
                    <img src="Colaboraci√≥n/7.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 7" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/8.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 8" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/9.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 9" onerror="this.style.display='none';">
                </div>
            </section>

            <!-- HOJA 6: CONSTRUCCI√ìN 10-12 -->
            <section id="sheet-6" class="sheet w-full max-w-5xl h-full bg-white/10 backdrop-blur-sm rounded-3xl p-4 border-4 border-pink-300/40 shadow-2xl flex-col justify-center space-y-3">
                <h2 class="sheet-title text-xl md:text-2xl font-bold text-yellow-300 text-center mb-1">
                    Hoja 6 ¬∑ Construcci√≥n (Pasos 10-12)
                </h2>
                <p class="text-[10px] md:text-xs text-center text-white/90">
                    Conecta ambos RoverBots con el m√≥dulo central.
                </p>
                <div class="grid grid-cols-3 gap-3">
                    <img src="Colaboraci√≥n/10.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 10" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/11.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 11" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/12.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 12" onerror="this.style.display='none';">
                </div>
            </section>

            <!-- HOJA 7: CONSTRUCCI√ìN 13-17 -->
            <section id="sheet-7" class="sheet w-full max-w-5xl h-full bg-white/10 backdrop-blur-sm rounded-3xl p-4 border-4 border-pink-300/40 shadow-2xl flex-col justify-center space-y-3">
                <h2 class="sheet-title text-xl md:text-2xl font-bold text-yellow-300 text-center mb-1">
                    Hoja 7 ¬∑ Construcci√≥n (Pasos 13-17)
                </h2>
                <p class="text-[10px] md:text-xs text-center text-white/90">
                    Revisa detalles finales y estabilidad de la estructura.
                </p>
                <div class="grid grid-cols-3 gap-3">
                    <img src="Colaboraci√≥n/13.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 13" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/14.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 14" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/15.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 15" onerror="this.style.display='none';">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <img src="Colaboraci√≥n/16.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 16" onerror="this.style.display='none';">
                    <img src="Colaboraci√≥n/17.jpg" class="w-full rounded-2xl border-2 border-white/40" alt="Paso 17" onerror="this.style.display='none';">
                </div>
                <p class="text-[8px] md:text-[9px] text-white/70">
                    Imagen ¬©2015 The LEGO Group. Usada con fines educativos y sin √°nimo de lucro.
                    Fuente: Instrucciones de construcci√≥n del set LEGO¬Æ Education WeDo 2.0 (45300).
                </p>
            </section>

            <!-- HOJA 8: PROGRAMA, PRUEBA Y CALCULA -->
            <section id="sheet-8" class="sheet w-full max-w-5xl h-full bg-white/10 backdrop-blur-sm rounded-3xl p-4 md:p-6 border-4 border-cyan-300/40 shadow-2xl flex-col justify-center space-y-3">
                <h2 class="sheet-title text-xl md:text-2xl font-bold text-yellow-300 text-center mb-1">
                    Hoja 8 ¬∑ Programa, prueba y calcula
                </h2>
                <p class="text-[10px] md:text-xs text-white/90 text-center px-2">
                    Usando tu pseudoc√≥digo, programa ambos RoverBots para seguir la ruta con giros y esquivar los cr√°teres.
                    Realiza al menos <span class="font-semibold">3 ensayos</span>.
                </p>
                <p class="text-[9px] md:text-xs text-purple-200 text-center">
                    Copia y completa esta tabla en tu cuaderno o en un archivo Word/Excel y s√∫bela luego al Drive como evidencia.
                </p>

                <div class="overflow-x-auto">
                    <table class="min-w-full text-[8px] md:text-[10px] text-center border border-white/30 rounded-2xl overflow-hidden">
                        <thead class="bg-black/60 text-purple-200">
                            <tr>
                                <th class="px-1 py-1 border border-white/20">Ensayo</th>
                                <th class="px-1 py-1 border border-white/20">Distancia total (cm)</th>
                                <th class="px-1 py-1 border border-white/20">Potencia A (%)</th>
                                <th class="px-1 py-1 border border-white/20">Potencia B (%)</th>
                                <th class="px-1 py-1 border border-white/20">Tiempo (s)</th>
                                <th class="px-1 py-1 border border-white/20">√Ångulos usados</th>
                                <th class="px-1 py-1 border border-white/20">¬øLlegan juntos?</th>
                            </tr>
                        </thead>
                        <tbody class="bg-black/40 text-white/90">
                            <tr>
                                <td class="border border-white/10">1</td><td class="border border-white/10"></td><td class="border border-white/10"></td>
                                <td class="border border-white/10"></td><td class="border border-white/10"></td><td class="border border-white/10"></td>
                                <td class="border border-white/10"></td>
                            </tr>
                            <tr>
                                <td class="border border-white/10">2</td><td class="border border-white/10"></td><td class="border border-white/10"></td>
                                <td class="border border-white/10"></td><td class="border border-white/10"></td><td class="border border-white/10"></td>
                                <td class="border border-white/10"></td>
                            </tr>
                            <tr>
                                <td class="border border-white/10">3</td><td class="border border-white/10"></td><td class="border border-white/10"></td>
                                <td class="border border-white/10"></td><td class="border border-white/10"></td><td class="border border-white/10"></td>
                                <td class="border border-white/10"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <p class="text-[9px] md:text-xs text-purple-200 text-center">
                    Escribe tambi√©n una breve explicaci√≥n: ¬øqu√© ajuste matem√°tico hizo que los dos RoverBots llegaran coordinados?
                </p>
            </section>

            <!-- HOJA 9: REFLEXI√ìN + EVIDENCIAS + COMPLETAR -->
            <section id="sheet-9" class="sheet w-full max-w-5xl h-full bg-white/10 backdrop-blur-sm rounded-3xl p-4 md:p-6 border-4 border-green-300/40 shadow-2xl flex-col justify-center space-y-3">
                <h2 class="sheet-title text-xl md:text-2xl font-bold text-yellow-300 text-center mb-1">
                    Hoja 9 ¬∑ Reflexiona y sube tus evidencias
                </h2>
                <p class="text-[10px] md:text-xs text-white/90 text-center">
                    Completa estas preguntas en tu cuaderno o en un archivo Word (Misi√≥n 3 - Reflexi√≥n) y s√∫belo al Drive del curso.
                </p>

                <ul class="list-decimal list-inside text-[10px] md:text-xs text-white/90 space-y-1 px-4">
                    <li>¬øPor qu√© fue importante coordinar a los dos RoverBots?</li>
                    <li>¬øC√≥mo usaron distancias, tiempos y √°ngulos para mejorar el recorrido?</li>
                    <li>Describe un ejemplo real de buena colaboraci√≥n en tu equipo.</li>
                </ul>

                <div class="mt-1 space-y-1 text-[9px] md:text-xs text-purple-200">
                    <p class="font-semibold">Evidencias que debes subir al Drive (Misi√≥n 3):</p>
                    <ul class="list-disc list-inside space-y-1 text-white/90">
                        <li>Archivo Word con el pseudoc√≥digo de la ruta.</li>
                        <li>Tabla de ensayos (en cuaderno escaneado o archivo digital).</li>
                        <li>Reflexiones respondidas.</li>
                        <li>Fotos de los RoverBots conectados, del escenario y de la programaci√≥n.</li>
                    </ul>
                </div>

                <div class="mt-3 flex flex-wrap justify-center gap-3">
                    <button id="complete-btn"
                            onclick="completeMission()"
                            class="px-5 py-2 bg-gradient-to-r from-green-500 to-green-700 text-white font-bold text-xs md:text-sm rounded-full shadow-lg transition-transform transform hover:scale-110 hover:shadow-2xl">
                        Marcar Misi√≥n 3 como completada
                    </button>
                    <a href="index.html"
                    id="completed-btn"
                    class="hidden px-5 py-2 bg-white text-green-600 font-bold text-xs md:text-sm rounded-full shadow-lg transition-transform transform hover:scale-110 hover:shadow-2xl">
                        Volver a Misiones
                    </a>
                </div>
            </section>
        </div>

        <!-- NAVEGACI√ìN ENTRE HOJAS -->
        <div class="relative z-20 flex items-center justify-between mt-2">
            <button id="prev-btn"
                    onclick="prevSheet()"
                    class="px-4 py-2 bg-white/10 border border-white/40 text-white text-xs md:text-sm rounded-full shadow-lg transition-transform transform hover:scale-105 disabled:opacity-30 disabled:hover:scale-100">
                ‚Üê Hoja anterior
            </button>
            <button id="next-btn"
                    onclick="nextSheet()"
                    class="px-4 py-2 bg-purple-500 text-white text-xs md:text-sm font-semibold rounded-full shadow-lg transition-transform transform hover:scale-105 disabled:opacity-30 disabled:hover:scale-100">
                Siguiente hoja ‚Üí
            </button>
        </div>
    </main>

    <script>
        // Estrellas
        function createStars() {
            const starsContainer = document.getElementById('stars');
            if (!starsContainer) return;
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                const size = Math.random() * 3 + 1;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // Progreso
        function getCurrentPlayer() {
            return localStorage.getItem('zython-current-player');
        }

        function loadPlayerProgress(playerName) {
            try {
                const players = JSON.parse(localStorage.getItem('zython-players') || '{}');
                return players[playerName] || {
                    completedMissions: [],
                    completed: 0,
                    currentMission: 1,
                    available: 1,
                    badges: 0
                };
            } catch (error) {
                console.error('Error loading progress:', error);
                return {
                    completedMissions: [],
                    completed: 0,
                    currentMission: 1,
                    available: 1,
                    badges: 0
                };
            }
        }

        function savePlayerProgress(playerName, progress) {
            try {
                const players = JSON.parse(localStorage.getItem('zython-players') || '{}');
                players[playerName] = progress;
                localStorage.setItem('zython-players', JSON.stringify(players));
            } catch (error) {
                console.error('Error saving progress:', error);
            }
        }

        // Navegaci√≥n entre hojas
        let currentSheet = 1;
        const totalSheets = 9;

        function showSheet(n) {
            if (n < 1 || n > totalSheets) return;
            currentSheet = n;

            for (let i = 1; i <= totalSheets; i++) {
                const sheet = document.getElementById(`sheet-${i}`);
                if (sheet) {
                    sheet.classList.toggle('active', i === currentSheet);
                }
            }

            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const sheetIndicator = document.getElementById('sheet-indicator');
            const sheetTotal = document.getElementById('sheet-total');

            if (sheetIndicator) sheetIndicator.textContent = currentSheet;
            if (sheetTotal) sheetTotal.textContent = totalSheets;

            if (prevBtn) prevBtn.disabled = currentSheet === 1;
            if (nextBtn) {
                nextBtn.disabled = currentSheet === totalSheets;
                nextBtn.textContent = currentSheet === totalSheets ? '√öltima hoja' : 'Siguiente hoja ‚Üí';
            }
        }

        function nextSheet() {
            if (currentSheet < totalSheets) showSheet(currentSheet + 1);
        }

        function prevSheet() {
            if (currentSheet > 1) showSheet(currentSheet - 1);
        }

        // Completar misi√≥n
        function checkCompletion() {
            const currentPlayer = getCurrentPlayer();
            if (currentPlayer) {
                const progress = loadPlayerProgress(currentPlayer);
                if (progress.completedMissions.includes(3)) {
                    const badge = document.getElementById('completion-badge');
                    const completeBtn = document.getElementById('complete-btn');
                    const completedBtn = document.getElementById('completed-btn');
                    if (badge) badge.classList.remove('hidden');
                    if (completeBtn) completeBtn.classList.add('hidden');
                    if (completedBtn) completedBtn.classList.remove('hidden');
                }
            }
        }

        function completeMission() {
            const currentPlayer = getCurrentPlayer();
            if (!currentPlayer) {
                console.error('No current player for mission completion');
                alert('Error: No se encontr√≥ informaci√≥n del jugador. Por favor, regresa al men√∫ principal.');
                return;
            }

            const progress = loadPlayerProgress(currentPlayer);

            if (!progress.completedMissions.includes(3)) {
                progress.completedMissions.push(3);
                progress.completed = progress.completedMissions.length;
                progress.badges = progress.completedMissions.length;

                progress.currentMission = Math.max(progress.currentMission, 4);
                progress.available = Math.max(progress.available, 4);

                savePlayerProgress(currentPlayer, progress);

                const badge = document.getElementById('completion-badge');
                const completeBtn = document.getElementById('complete-btn');
                const completedBtn = document.getElementById('completed-btn');
                if (badge) badge.classList.remove('hidden');
                if (completeBtn) completeBtn.classList.add('hidden');
                if (completedBtn) completedBtn.classList.remove('hidden');

                alert('¬°Felicitaciones! Has obtenido la Insignia "Colaboraci√≥n en Sensorium". La Misi√≥n 4 ahora est√° disponible.');
            } else {
                alert('Esta misi√≥n ya ha sido completada anteriormente.');
            }
        }

        function volverAMisiones() {
            window.location.href = 'index.html';
        }

        function initialize() {
            createStars();
            showSheet(1);
            checkCompletion();
        }

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
